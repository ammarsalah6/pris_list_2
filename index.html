<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>قائمة الأسعار - المكسرات والحلويات</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            /* ألوان مستوحاة من اللوجو ومنتجات المكسرات/القهوة */
            --primary-dark: #3E2723;   /* بني غامق */
            --primary-light: #5D4037;  /* بني متوسط */
            --accent-gold: #C67C00;    /* ذهبي (للأسعار والتمييز) */
            --bg-cream: #FFF8E1;       /* كريمي (خلفية الورق) */
            --text-main: #212121;      /* لون الخط الرئيسي */
            --border-color: #D7CCC8;   /* لون الحدود الفاتح */
            /* مقاسات ثابتة لصفحة الكتاب */
            --page-height: 550px; 
            --page-padding: 30px;
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #ECEFF1;
            background-image: url("https://www.transparenttextures.com/patterns/cream-paper.png");
            margin: 0;
            padding-bottom: 0; 
            color: var(--text-main);
        }

        /* حاوية المنيو (شكل الكتاب) */
        .menu-book {
            max-width: 900px;
            margin: 40px auto; 
            background-color: var(--bg-cream);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            border-left: 1px solid #ccc;
            border-right: 12px solid var(--primary-dark); /* كعب الكتاب */
        }

        /* تنسيق رأس الصفحة واللوجو */
        header {
            text-align: center;
            padding: 30px 20px 20px;
            background: linear-gradient(to bottom, #fff, var(--bg-cream));
            border-bottom: 2px dashed var(--primary-light);
        }

        .logo-container img {
            max-width: 150px;
            height: auto;
            filter: drop-shadow(0 6px 10px rgba(0,0,0,0.15));
            margin-bottom: 10px;
            display: block; 
            margin-left: auto;
            margin-right: auto;
        }

        header h1 {
            font-family: 'Amiri', serif;
            font-size: 2.2rem;
            color: var(--primary-dark);
            margin: 5px 0;
            font-weight: 700;
        }
        
        header p {
            color: var(--primary-light);
            font-size: 1rem;
            margin-top: 5px;
        }

        /* تنسيق مربع البحث */
        .search-container {
            position: sticky;
            top: 0;
            background: var(--bg-cream);
            padding: 10px 30px;
            z-index: 10;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08); 
            display: flex;
            justify-content: center;
        }
        
        .search-box {
            position: relative;
            width: 100%;
            max-width: 600px;
        }

        .search-box input {
            width: 100%;
            padding: 10px 50px 10px 20px;
            border: 2px solid var(--border-color);
            border-radius: 50px;
            font-family: 'Tajawal', sans-serif;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s; 
            background: #fff;
        }

        .search-box input:focus {
            border-color: var(--primary-dark); 
            box-shadow: 0 0 0 3px rgba(62, 39, 35, 0.2); 
        }

        .search-box i {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary-light);
        }

        /* تنسيق الصفحات */
        #page-content {
            padding: var(--page-padding);
            height: var(--page-height); 
            overflow: hidden; 
            position: relative;
            box-sizing: border-box; 
        }

        .category-title {
            font-family: 'Amiri', serif;
            font-size: 1.8rem;
            color: var(--primary-dark);
            border-bottom: 2px solid var(--accent-gold);
            display: inline-block;
            margin-bottom: 15px;
            padding-bottom: 5px;
        }
        
        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
        }

        /* ----- تعديلات كارت الصنف ----- */
        .menu-item {
            background: #fff;
            border: 1px solid var(--border-color);
            padding: 10px 15px;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }

        .menu-item:hover {
            transform: translateY(-2px);
            border-color: var(--accent-gold);
        }

        .item-info {
            flex-grow: 1;
        }

        .item-name {
            font-weight: 700;
            color: var(--primary-dark);
            font-size: 1rem;
            margin-bottom: 4px;
        }

        .item-unit {
            font-size: 0.85rem;
            color: #757575; /* لون رمادي للوحدة */
            background-color: #f5f5f5;
            padding: 2px 8px;
            border-radius: 4px;
            display: inline-block;
        }

        .item-price {
            font-weight: 700;
            color: var(--accent-gold);
            font-size: 1.1rem;
            white-space: nowrap;
            margin-right: 10px;
        }
        
        .currency {
            font-size: 0.8rem;
            color: var(--primary-light);
        }
        /* --------------------------- */

        .toggle-btn {
            width: 100%;
            padding: 10px;
            margin-top: 15px;
            border: none;
            background-color: var(--primary-light);
            color: #fff;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Tajawal', sans-serif;
            font-size: 1rem;
            transition: background-color 0.3s;
        }

        /* شريط السوشيال ميديا */
        .social-bar {
            max-width: 900px; 
            margin: 20px auto 30px auto; 
            background: var(--primary-dark);
            padding: 10px 0;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            border-radius: 8px;
        }

        .social-bar a {
            color: #D7CCC8;
            font-size: 1.3rem; 
            margin: 0 15px;
            transition: 0.3s;
        }

        .social-bar a:hover {
            color: var(--accent-gold);
            transform: scale(1.1);
        }

        /* شريط التنقل */
        .pagination-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px;
            background-color: var(--primary-dark);
            color: #fff;
            font-family: 'Tajawal', sans-serif;
            user-select: none;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1); 
        }
        
        .nav-btn {
            background-color: var(--primary-light);
            color: #fff;
            padding: 10px 20px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 700;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            white-space: nowrap; 
        }

        .nav-btn:hover:not(:disabled) { background-color: var(--accent-gold); }
        .nav-btn:disabled { background-color: #5D403750; cursor: not-allowed; color: #ccc; }

        .page-info {
            font-size: 1.1rem;
            font-weight: 500;
            text-align: center;
        }

        /* التجاوب مع الموبايل */
        @media (max-width: 600px) {
            :root {
                --page-height: 55vh; 
                --page-padding: 20px;
            }
            .menu-book {
                margin: 0;
                border-right: none;
                border-radius: 0;
                width: 100%;
            }
            .pagination-nav {
                padding: 10px 15px;
            }
            .nav-btn {
                padding: 8px 15px;
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>

    <div class="menu-book">
        <header>
            <div class="logo-container">
                <img src="logo.png" alt="شعار المحل" onerror="this.style.display='none'">
            </div>
            <h1>قائمة الأصناف</h1>
            <p>أجود الأنواع وأفضل الأسعار</p>
        </header>

        <div class="search-container">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="ابحث عن صنف...">
            </div>
        </div>

        <div id="page-content">
            <div class="loader" style="text-align:center; padding-top:50px;">
                <i class="fas fa-spinner fa-spin"></i> جاري تحميل القائمة...
            </div>
        </div>
        
        <div class="pagination-nav">
            <button id="prevBtn" class="nav-btn" disabled>
                <i class="fas fa-chevron-right"></i> السابق
            </button>
            
            <div id="pageInfo" class="page-info"></div>

            <button id="nextBtn" class="nav-btn" disabled>
                التالي <i class="fas fa-chevron-left"></i>
            </button>
        </div>
    </div>
    
    <div class="social-bar">
        <a href="#"><i class="fab fa-facebook-f"></i></a>
        <a href="#"><i class="fab fa-whatsapp"></i></a>
        <a href="#"><i class="fab fa-instagram"></i></a>
        <a href="tel:01000000000" title="اتصل بنا"><i class="fas fa-phone-alt"></i></a>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

    <script>
        // **********************************************************
        // ضع رابط الشيت هنا (تأكد من وجود عمود باسم "الوحدة")
        // **********************************************************
        const sheetURL = 'https://docs.google.com/spreadsheets/d/1JUkNhA9CUVDXa6IzABg_zPvKiLezYIXvMECSzbV7-m8/edit?usp=sharing';

        const pageContent = document.getElementById('page-content');
        const searchInput = document.getElementById('searchInput');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const pageInfo = document.getElementById('pageInfo');
        const socialBar = document.querySelector('.social-bar'); 
        
        let allData = [];
        let allCategories = [];
        let currentPageIndex = 0;
        const ITEMS_PER_PREVIEW = 8; 

        // دالة مساعدة للبحث عن اسم العمود حتى لو فيه مسافات
        function findKey(item, target) {
            for (const key in item) {
                if (key && key.trim() === target) {
                    return key;
                }
            }
            return null;
        }
        
        function processData(data) {
            const categoriesMap = {};
            
            data.forEach(item => {
                const categoryKey = findKey(item, 'التصنيف');
                const nameKey = findKey(item, 'الصنف');
                const unitKey = findKey(item, 'الوحدة'); // البحث عن عمود الوحدة
                const priceKey = findKey(item, 'السعر');

                const category = categoryKey ? item[categoryKey] : null;
                const name = nameKey ? item[nameKey] : null;
                const unit = unitKey ? item[unitKey] : ''; // قراءة الوحدة
                const price = priceKey ? item[priceKey] : null;

                if (category && category.trim() !== '' && name && name.trim() !== '') {
                    const cleanCat = category.trim();
                    if (!categoriesMap[cleanCat]) {
                        categoriesMap[cleanCat] = [];
                    }
                    // تخزين الاسم والوحدة والسعر
                    categoriesMap[cleanCat].push({ 
                        name: name.trim(), 
                        unit: unit ? unit.trim() : '', 
                        price: price ? price.trim() : null 
                    });
                }
            });

            allCategories = Object.keys(categoriesMap).map(catName => ({
                categoryName: catName,
                items: categoriesMap[catName]
            })).filter(cat => cat.items.length > 0);
        }

        function fetchMenu() {
            Papa.parse(sheetURL, {
                download: true,
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    allData = results.data;
                    processData(allData);
                    
                    if (allCategories.length > 0) {
                        displayPage(0); 
                        setupNavigation(); 
                    } else {
                        pageContent.innerHTML = `<div class="error-msg" style="text-align:center; padding:20px;">لا توجد بيانات صالحة للعرض.<br>تأكد من الأعمدة (التصنيف, الصنف, الوحدة, السعر).</div>`;
                        nextBtn.disabled = true;
                        prevBtn.disabled = true;
                    }
                },
                error: function(err) {
                    pageContent.innerHTML = `<div class="error-msg" style="text-align:center;">حدث خطأ أثناء تحميل البيانات.</div>`;
                }
            });
        }
        
        function renderCategoryContent(categoryData, isFullView = false) {
            pageContent.innerHTML = '';

            const section = document.createElement('section');
            section.className = 'category-section';

            const title = document.createElement('div');
            title.className = 'category-title';
            title.innerText = categoryData.categoryName;
            section.appendChild(title);

            const grid = document.createElement('div');
            grid.className = 'items-grid';

            const itemsToRender = isFullView ? categoryData.items : categoryData.items.slice(0, ITEMS_PER_PREVIEW);

            itemsToRender.forEach(item => {
                const itemEl = document.createElement('div');
                itemEl.className = 'menu-item';
                
                let priceDisplay = item.price ? item.price : '--';
                let unitDisplay = item.unit ? `<span class="item-unit">${item.unit}</span>` : '';
                
                // تعديل هيكل HTML ليشمل الوحدة
                itemEl.innerHTML = `
                    <div class="item-info">
                        <div class="item-name">${item.name}</div>
                        ${unitDisplay}
                    </div>
                    <div class="item-price">
                        ${priceDisplay} <span class="currency">ج.م</span>
                    </div>
                `;
                grid.appendChild(itemEl);
            });

            section.appendChild(grid);
            pageContent.appendChild(section);

            if (categoryData.items.length > ITEMS_PER_PREVIEW) {
                const toggleButton = document.createElement('button');
                toggleButton.className = 'toggle-btn';
                toggleButton.setAttribute('data-full-view', isFullView ? 'true' : 'false');
                toggleButton.innerText = isFullView ? 'عرض الأقل' : `عرض المزيد (${categoryData.items.length - ITEMS_PER_PREVIEW} صنف إضافي)`;
                
                toggleButton.onclick = function() {
                    const newFullView = this.getAttribute('data-full-view') !== 'true';
                    renderCategoryContent(categoryData, newFullView);
                    pageContent.scrollTop = 0;
                };

                pageContent.appendChild(toggleButton);
                
                if (isFullView) {
                    pageContent.style.overflowY = 'auto'; 
                } else {
                    pageContent.style.overflowY = 'hidden'; 
                }
            } else {
                 pageContent.style.overflowY = 'hidden'; 
            }
        }
        
        function displayPage(index) {
            if (index >= 0 && index < allCategories.length) {
                currentPageIndex = index;
                const currentCategory = allCategories[index];
                renderCategoryContent(currentCategory, false);
                updateNavigationUI();
            }
        }
        
        function updateNavigationUI() {
            const totalPages = allCategories.length;
            const isLastPage = currentPageIndex === totalPages - 1;
            const isFirstPage = currentPageIndex === 0;
            
            prevBtn.disabled = isFirstPage;
            nextBtn.disabled = isLastPage;
            
            const currentCatName = allCategories[currentPageIndex].categoryName;
            pageInfo.innerHTML = `التصنيف الحالي: <strong>${currentCatName}</strong> <br> صفحة ${currentPageIndex + 1} من ${totalPages}`;

            if (!isLastPage) {
                const nextCatName = allCategories[currentPageIndex + 1].categoryName;
                nextBtn.innerHTML = `التالي: ${nextCatName} <i class="fas fa-chevron-left"></i>`;
            } else {
                nextBtn.innerHTML = `النهاية <i class="fas fa-check"></i>`;
            }
            
            if (!isFirstPage) {
                const prevCatName = allCategories[currentPageIndex - 1].categoryName;
                prevBtn.innerHTML = `<i class="fas fa-chevron-right"></i> السابق: ${prevCatName}`;
            } else {
                prevBtn.innerHTML = `<i class="fas fa-chevron-right"></i> البداية`;
            }
            
            document.querySelector('.pagination-nav').style.display = 'flex';
            socialBar.style.display = 'block';
        }
        
        function setupNavigation() {
            prevBtn.onclick = () => {
                if (currentPageIndex > 0) {
                    displayPage(currentPageIndex - 1);
                }
            };

            nextBtn.onclick = () => {
                if (currentPageIndex < allCategories.length - 1) {
                    displayPage(currentPageIndex + 1);
                }
            };
        }
        
        function handleSearch(term) {
            if (term.trim() === '') {
                displayPage(currentPageIndex); 
                document.querySelector('.pagination-nav').style.display = 'flex';
                socialBar.style.display = 'block';
                return;
            }
            
            const filteredData = allData.filter(item => {
                const nameKey = findKey(item, 'الصنف');
                const catKey = findKey(item, 'التصنيف');

                const nameMatch = nameKey && item[nameKey] && item[nameKey].toLowerCase().includes(term);
                const catMatch = catKey && item[catKey] && item[catKey].toLowerCase().includes(term);
                
                return nameMatch || catMatch;
            });

            document.querySelector('.pagination-nav').style.display = 'none';
            socialBar.style.display = 'none'; 

            if (filteredData.length === 0) {
                pageContent.innerHTML = `<div style="padding: 20px; text-align: center;">لا توجد نتائج مطابقة لـ "<strong>${term}</strong>"</div>`;
                return;
            }

            const searchCategory = {
                categoryName: `نتائج البحث عن: "${term}"`,
                items: filteredData.map(item => {
                     const nameKey = findKey(item, 'الصنف');
                     const unitKey = findKey(item, 'الوحدة');
                     const priceKey = findKey(item, 'السعر');
                    return { 
                        name: item[nameKey].trim(), 
                        unit: unitKey && item[unitKey] ? item[unitKey].trim() : '',
                        price: item[priceKey] ? item[priceKey].trim() : null
                    };
                })
            };
            
            renderCategoryContent(searchCategory, true);
        }

        searchInput.addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            handleSearch(term);
        });

        fetchMenu();
    </script>
</body>
</html>